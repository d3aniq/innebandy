// (Same app.js as previously generated)
import { createElement as h, useEffect, useMemo, useState } from "https://esm.sh/react@18";
import { createRoot } from "https://esm.sh/react-dom@18/client";
function cx(...cls){return cls.filter(Boolean).join(" ")}
function Badge({children}){return h("span",{className:"text-xs px-2 py-1 rounded-full bg-slate-200"},children)}
function StatCard({title, value, sub}){return h("div",{className:"rounded-2xl bg-white shadow p-4"},[h("div",{className:"text-sm text-slate-500"},title),h("div",{className:"text-3xl font-semibold mt-1"}, value),sub && h("div",{className:"text-xs text-slate-500 mt-1"}, sub)])}
function SearchSelect({label, options, value, onChange, placeholder="Välj...", multiple=false}){return h("div",{className:"flex flex-col gap-1"},[h("label",{className:"text-xs text-slate-600"},label),h("select",{className:"rounded-xl border p-2 bg-white",value: multiple ? undefined : value,multiple,onChange: e => {if(multiple){const vals = Array.from(e.target.selectedOptions).map(o=>o.value);onChange(vals);} else {onChange(e.target.value);}}},[!multiple && h("option",{value:""},placeholder),...options.map(o=>h("option",{key:o, value:o},o))])])}
function DateRange({min,max,value,onChange}){const [from,to] = value;return h("div",{className:"grid grid-cols-2 gap-2"},[h("div",{},[h("label",{className:"text-xs text-slate-600"},"Från"),h("input",{type:"date",className:"rounded-xl border p-2 w-full", min, max, value:from||"", onChange:e=>onChange([e.target.value||"",to])})]),h("div",{},[h("label",{className:"text-xs text-slate-600"},"Till"),h("input",{type:"date",className:"rounded-xl border p-2 w-full", min, max, value:to||"", onChange:e=>onChange([from,e.target.value||""]) })])])}
function useChart(id, cfg){useEffect(()=>{const el = document.getElementById(id); if(!el) return; if(el._chart){ el._chart.destroy(); } const chart = new Chart(el, cfg); el._chart = chart; return ()=> chart.destroy();},[id, JSON.stringify(cfg)])}
function PartnersChart({data}){const id = "partners-"+Math.random().toString(36).slice(2); const labels = data.map(d=>d.coreferees); const values = data.map(d=>d.together_matches); useChart(id, {type:"bar", data:{labels, datasets:[{label:"Matcher ihop", data:values}]}, options:{responsive:true, plugins:{legend:{display:false}}}}); return h("canvas",{id, height:160});}
function SeriesChart({data}){const id = "series-"+Math.random().toString(36).slice(2); const labels = data.map(d=>d.series || "Okänd"); const values = data.map(d=>d.matches); useChart(id, {type:"bar", data:{labels, datasets:[{label:"Matcher per serie", data:values}]}, options:{responsive:true, plugins:{legend:{display:false}}}}); return h("canvas",{id, height:160});}
function TopList({items, labelKey, valueKey, empty="—"}){if(!items?.length) return h("div",{className:"text-sm text-slate-500"},empty); return h("ul",{className:"text-sm"}, items.map((it,i)=> h("li",{key:i,className:"flex justify-between border-b py-1"},[h("span",{}, it[labelKey] || "—"),h("span",{className:"font-mono"}, it[valueKey])])));}
function MatchesTable({rows}){return h("div",{className:"overflow-x-auto rounded-2xl border bg-white"},[h("table",{className:"min-w-full text-sm"},[h("thead",{className:"bg-slate-100"}, h("tr",{},[h("th",{className:"text-left p-2"},"Datum"),h("th",{className:"text-left p-2"},"Tid"),h("th",{className:"text-left p-2"},"Serie"),h("th",{className:"text-left p-2"},"Arena"),h("th",{className:"text-left p-2"},"Hemma"),h("th",{className:"text-left p-2"},"Borta"),h("th",{className:"text-left p-2"},"Länk") ])),h("tbody",{}, rows.map((r,i)=> h("tr",{key:r.match_id, className: i%2? "bg-slate-50":""},[h("td",{className:"p-2"}, r.date || ""),h("td",{className:"p-2"}, r.time || ""),h("td",{className:"p-2"}, r.series || ""),h("td",{className:"p-2"}, r.arena || ""),h("td",{className:"p-2"}, r.home || ""),h("td",{className:"p-2"}, r.away || ""),h("td",{className:"p-2"}, r.url ? h("a",{href:r.url, target:"_blank", className:"text-blue-600 underline"},"Match") : "—")])) )])])}
function App(){const [data, setData] = useState(null);const [loading, setLoading] = useState(true);const [error, setError] = useState(null);const [referee, setReferee] = useState("");const [compareRefs, setCompareRefs] = useState([]);const [seriesFilter, setSeriesFilter] = useState([]);const [arenaFilter, setArenaFilter] = useState([]);const [dateRange, setDateRange] = useState(["",""]);useEffect(()=>{fetch("./data.json").then(r=>r.json()).then(setData).catch(e=>setError(e.toString())).finally(()=>setLoading(false));},[]);const filteredMatches = useMemo(()=>{if(!data) return [];const [from,to] = dateRange;const fromD = from ? new Date(from) : null;const toD = to ? new Date(to) : null;return data.matches.filter(m=>{const d = m.date ? new Date(m.date) : null;if(fromD && (!d || d < fromD)) return false;if(toD && (!d || d > toD)) return false;if(seriesFilter.length && !seriesFilter.includes(m.series)) return false;if(arenaFilter.length && !arenaFilter.includes(m.arena)) return false;if(referee && !m.referees.includes(referee)) return false;return true;});},[data, referee, seriesFilter, arenaFilter, dateRange]);const current = useMemo(()=>{if(!data || !referee || !data.referees[referee]) return null;return data.referees[referee];},[data, referee]);if(loading) return h("div",{className:"p-6"},"Laddar...");if(error) return h("div",{className:"p-6 text-red-600"}, "Fel: "+error);if(!data) return h("div",{className:"p-6"},"Ingen data");return h("div",{className:"space-y-4"},[h("div",{className:"flex items-center justify-between"},[h("h1",{className:"text-2xl font-semibold"},"Domar-dashboard"),h("div",{className:"text-sm text-slate-500"}, h(Badge,null, `Period: ${data.date_min || "?"} → ${data.date_max || "?"}`))]),h("div",{className:"grid md:grid-cols-4 gap-3"},[h(SearchSelect, {label:"Domare", options:data.all_referees, value:referee, onChange:setReferee, placeholder:"Välj domare"}),h(SearchSelect, {label:"Jämför med", options:data.all_referees.filter(r=>r!==referee), value:compareRefs, onChange:setCompareRefs, multiple:true}),h(SearchSelect, {label:"Serier", options:data.all_series, value:seriesFilter, onChange:setSeriesFilter, multiple:true}),h(SearchSelect, {label:"Arenor", options:data.all_arenas, value:arenaFilter, onChange:setArenaFilter, multiple:true}),]),h("div",{className:"grid md:grid-cols-3 gap-3"},[h(DateRange, {min:data.date_min||"", max:data.date_max||"", value:dateRange, onChange:setDateRange}),h("div",{className:"self-end"}, h("button",{className:"px-3 py-2 rounded-xl bg-slate-900 text-white", onClick:()=>{setReferee("");setCompareRefs([]);setSeriesFilter([]);setArenaFilter([]);setDateRange(["",""]);}}, "Rensa filter"))]),h("div",{className:"grid md:grid-cols-4 gap-3"},[h(StatCard, {title:"Matcher i vyn", value: filteredMatches.length}),h(StatCard, {title:"Vald domare", value: referee || "—", sub: referee? `${data.referees[referee]?.total_matches ?? 0} matcher totalt` : ""}),h(StatCard, {title:"Serier (filter)", value: seriesFilter.length || "—"}),h(StatCard, {title:"Arenor (filter)", value: arenaFilter.length || "—"}),]), referee && current && h("div",{className:"grid md:grid-cols-2 gap-3"},[h("div",{className:"rounded-2xl bg-white shadow p-4"},[h("div",{className:"font-semibold mb-2"},"Topp-partners"),h(PartnersChart,{data: current.top_partners})]),h("div",{className:"rounded-2xl bg-white shadow p-4"},[h("div",{className:"font-semibold mb-2"},"Seriefördelning"),h(SeriesChart,{data: current.series_distribution})]),h("div",{className:"rounded-2xl bg-white shadow p-4"},[h("div",{className:"font-semibold mb-2"},"Lag du dömt mest"),h(TopList,{items: current.top_teams, labelKey:"team", valueKey:"matches"})]),h("div",{className:"rounded-2xl bg-white shadow p-4"},[h("div",{className:"font-semibold mb-2"},"Arenor du dömt mest på"),h(TopList,{items: current.top_arenas, labelKey:"arena", valueKey:"matches"})]),]), compareRefs?.length ? h("div",{className:"rounded-2xl bg-white shadow p-4"},[h("div",{className:"font-semibold mb-2"},"Jämförelse (matcher totalt)"),h("table",{className:"min-w-full text-sm"},[h("thead",{className:"bg-slate-100"}, h("tr",{},[h("th",{className:"text-left p-2"},"Domare"), h("th",{className:"text-left p-2"},"Matcher totalt")])),h("tbody",{}, compareRefs.map((r,i)=> h("tr",{key:r, className: i%2? "bg-slate-50":""},[h("td",{className:"p-2"}, r),h("td",{className:"p-2"}, data.referees[r]?.total_matches ?? 0)])))])]) : null,h("div",{className:"mt-2"},[h("div",{className:"font-semibold mb-2"},"Matcher i vyn"),h(MatchesTable,{rows: filteredMatches.map(m=>{const rdet = data.referees[referee];const mm = rdet?.matches?.find(x=>x.match_id===m.match_id);return {match_id: m.match_id,date: mm?.date || m.date,time: mm?.time || "",home: m.home,away: m.away,series: m.series,arena: m.arena,url: m.url}})})]) ])}
createRoot(document.getElementById("app")).render(h(App));
